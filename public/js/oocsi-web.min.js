var OOCSI=(function(){var h="ws://localhost:9000/";var r;var n={};var l;var b=false;var m=p;function c(){m("CONNECTING to "+h);l=new WebSocket(h);l.onopen=function(s){i(s)};l.onclose=function(s){k(s)};l.onmessage=function(s){g(s)};l.onerror=function(s){a(s)}}function i(s){if(l.readyState==WebSocket.OPEN){f(r);b=true}m("CONNECTED")}function k(s){m("DISCONNECTED")}function g(t){try{var s=JSON.parse(t.data);if(n[s.recipient]!==undefined){n[s.recipient](s)}else{m("no handler for event: "+t.data)}}catch(s){m("parse exception for event: "+t.data)}m("RESPONSE: "+t.data)}function a(s){m("ERROR: "+s.data)}function j(s){if(!l||l.readyState==WebSocket.CONNECTING){setTimeout(function(){j(s)},200)}else{s()}}function e(){l&&l.close()}function f(s){if(l&&l.send(s)){m("SENT: "+s)}}function p(s){}function d(t,s){b&&f("sendjson "+t+" "+JSON.stringify(s))}function o(s,t){if(b){f("subscribe "+s);n[s]=t}}function q(s){if(b){f("unsubscribe "+s);n[s]=function(){}}}return{connect:function(s,u,t){h=s;r=u&&u.length>0?u:"webclient_"+ +(new Date());n[u]=t;c()},send:function(t,s){d(t,s)},subscribe:function(s,t){j(function(){o(s,t)})},unsubscribe:function(s){j(function(){q(s)})},close:function(){j(function(){e()})},handlers:function(){return n},logger:function(s){m=s}}})();